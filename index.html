<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>15지는 블로그</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage.js"></script>

    <script type="module">
      // Firebase SDK 라이브러리 가져오기
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
      import {
        getFirestore,
        collection,
        addDoc,
        getDocs,
      } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
      import {
        getStorage,
        ref as sRef,
        uploadBytes,
        getDownloadURL,
      } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-storage.js";

      // For Firebase JS SDK v7.20.0 and later, measurementId is optional
      const firebaseConfig = {
        apiKey: "AIzaSyAfN5PZcj9NbBj2vdB8JMFQp_zTAm-xHuk",
        authDomain: "js-miniproject.firebaseapp.com",
        projectId: "js-miniproject",
        storageBucket: "js-miniproject.appspot.com",
        messagingSenderId: "682214502456",
        appId: "1:682214502456:web:686883842015c32e59f6cd",
        measurementId: "G-G9NFH0GQ2E",
      };

      // Firebase 인스턴스 초기화
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);
      async function uploadFile(file) {
        const storage = getStorage(app);
        const storageRef = sRef(storage, `images/${file.name}`);
        const snapshot = await uploadBytes(storageRef, file);
        const downloadURL = await getDownloadURL(snapshot.ref);
        return downloadURL;
      }

      $(document).ready(function () {
        // 멤버 추가 버튼 이벤트 리스너
        $("#addbtn").click(async function () {
          const fileInput = document.getElementById("imageUpload");
          if (fileInput.files.length > 0) {
            const file = fileInput.files[0];
            const imageUrl = await uploadFile(file);
            const name = $("#name").val();

            await addDoc(collection(db, "members"), {
              name: name,
              image: imageUrl,
            });
            alert("멤버가 추가되었습니다.");
            // 페이지를 새로고침하는 대신 멤버 목록을 업데이트하는 함수를 호출할 수 있습니다.
          } else {
            alert("이미지 파일을 선택해주세요.");
          }
        });

        // 멤버 목록 업데이트 함수
        async function updateMemberList() {
          $(".teamMembers").empty();
          const docs = await getDocs(collection(db, "members"));
          docs.forEach((doc) => {
            let data = doc.data();
            let temp_html = `<div class="member">
        <a href="personalPage.html?memberId=${doc.id}">
          <img src="${data.image}" class="bd-placeholder-img rounded-circle" width="140" height="140" />
          <span class="name">${data.name}</span>
        </a>
      </div>`;
            $(".teamMembers").append(temp_html);
          });
        }

        // 페이지 로드 시 멤버 목록을 불러옵니다.
        updateMemberList();
      });
      function getLocation() {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(saveLocation, showError);
        } else {
          console.log("Geolocation is not supported by this browser.");
        }
      }

      function saveLocation(position) {
        const { latitude, longitude } = position.coords;
        localStorage.setItem(
          "location",
          JSON.stringify({ latitude, longitude })
        );
        console.log("Location saved:", latitude, longitude);
      }

      function showError(error) {
        switch (error.code) {
          case error.PERMISSION_DENIED:
            console.log("User denied the request for Geolocation.");
            break;
          case error.POSITION_UNAVAILABLE:
            console.log("Location information is unavailable.");
            break;
          case error.TIMEOUT:
            console.log("The request to get user location timed out.");
            break;
          case error.UNKNOWN_ERROR:
            console.log("An unknown error occurred.");
            break;
        }
      }
    </script>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="css/index.css" />
    <link rel="stylesheet" href="css/teamMembers.css" />
    <link rel="stylesheet" href="css/navbar.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
    />
  </head>

  <body>
    <div class="navbar">
      <div class="left-container">
        <div id="weather"><span></span><span></span></div>
        <div class="countdown">
          <span>부트캠프 종료 :</span>
          <span id="countdown"></span>
        </div>
      </div>

      <div class="title-container">
        <h1 class="title"><img src="img/logo.png" / width="300px"></h1>
      </div>
      <div class="right-container">
        <div class="home">
          <a href="index.html">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="30"
              height="30"
              fill="currentColor"
              class="bi bi-house-door-fill"
              viewBox="0 0 16 16"
            >
              <path
                d="M6.5 14.5v-3.505c0-.245.25-.495.5-.495h2c.25 0 .5.25.5.5v3.5a.5.5 0 0 0 .5.5h4a.5.5 0 0 0 .5-.5v-7a.5.5 0 0 0-.146-.354L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293L8.354 1.146a.5.5 0 0 0-.708 0l-6 6A.5.5 0 0 0 1.5 7.5v7a.5.5 0 0 0 .5.5h4a.5.5 0 0 0 .5-.5"
              />
            </svg>
          </a>
        </div>

        <div class="theme-switch">
          <!-- 테마 토글 버튼 -->
          <button
            class="theme-btn light"
            onclick="changeTheme('light')"
            title="Light mode"
          >
            <img src="https://assets.codepen.io/210284/sun.png" alt="sun" />
          </button>
          <button
            class="theme-btn dark"
            onclick="changeTheme('dark')"
            title="Dark mode"
          >
            <img src="https://assets.codepen.io/210284/moon.png" alt="moon" />
          </button>
        </div>
      </div>
    </div>

    <div class="mainContainer">
      <div class="animate__animated animate__fadeIn">
        <!-- 메인 소개글 -->
        <section class="mainIntroduce">
          <h1>
            <span style="color: #0c347a"><b>15지는 팀</b></span
            >의 <br />
            <span style="color: #0c347a"><b>15지는 블로그</b></span
            >를 소개합니다.
          </h1>
          <h6>
            우리는 블라블라블라블라블라블라블라<br />
            달디달디달디달디단 십오조입니다.
          </h6>
          <img
            src="img/mimojieg.png"
            style="
              width: 600px;
              height: 500px;
              filter: drop-shadow(8px 4px 4px #c3c3c3);
            "
          />
        </section>
      </div>
      <!-- 기존 hr에 class왜 지정하는건지 모르겠어서 그냥 임의로 바꿔봤습니다.. -->
      <hr />
      <!-- <hr class="featurette-divider" /> -->
      <section class="teamIntroduction">
        <!-- 팀 소개 글 -->
        <h1 style="color: #0c347a"><b>"15지는조"</b></h1>
        <p>
          15지는 조는 "이은규", "김윤재", "최유진"으로 이루어진 조입니다.<br />
          백엔드 개발자가 되기 위해 열심히 정진중입니다.<br />
          아래의 프로필을 클릭하여 15지는 조의 조원들에 대해 알아보세요!<br /><br />
        </p>
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="30"
          height="30"
          fill="currentColor"
          class="bi bi-chevron-compact-down"
          viewBox="0 0 16 16"
        >
          <path
            fill-rule="evenodd"
            d="M1.553 6.776a.5.5 0 0 1 .67-.223L8 9.44l5.776-2.888a.5.5 0 1 1 .448.894l-6 3a.5.5 0 0 1-.448 0l-6-3a.5.5 0 0 1-.223-.67"
          />
        </svg>
      </section>

      <hr />
      <section class="mypostingbox">
        <div class="form-floating mb-3">
          <input
            type="file"
            class="form-control"
            id="imageUpload"
            placeholder="이미지 업로드"
            accept="image/*"
          />
          <label for="imageUpload">사진</label>
        </div>

        <div class="form-floating mb-3">
          <input
            type="email"
            class="form-control"
            id="name"
            placeholder="dlfma"
          />
          <label for="name">이름</label>
        </div>
        <button id="addbtn" type="button" class="btn btn-primary">
          추가하기
        </button>
      </section>
      <button type="button" id="addMemberbtn" class="btn btn-outline-info">
        멤버 추가
      </button>
      <section class="teamMembers">
        <div class="member"></div>
      </section>
    </div>
    <script src="js/theme.js"></script>
    <script src="js/weather.js"></script>
    <script src="js/scroll.js"></script>
    <script src="js/posting.js"></script>
    <script src="js/dday.js"></script>
  </body>
</html>
